<script>
let watchlistData = {};
let macroData = {};
let currentAsset = null;

async function loadData() {
  const w = await fetch('watchlist.json');
  watchlistData = await w.json();

  const m = await fetch('macro_data.json');
  macroData = await m.json();

  buildSelector();
}

function buildSelector() {
  const select = document.getElementById("assetSelect");

  for (const category in watchlistData) {
    const group = document.createElement("optgroup");
    group.label = category;

    watchlistData[category].forEach(asset => {
      const option = document.createElement("option");
      option.value = asset.symbol;
      option.textContent = asset.name;
      group.appendChild(option);
    });

    select.appendChild(group);
  }

  select.addEventListener("change", () => {
    currentAsset = select.value;
    updateAssetView();
  });

  currentAsset = select.value;
  updateAssetView();
}

function updateAssetView() {
  const assetName =
    document.getElementById("assetSelect").selectedOptions[0].text;

  document.getElementById("assetName").textContent = assetName;

  const assetData = macroData.assets[currentAsset];

  if (!assetData) {
    document.getElementById("assetName").textContent += " (sin datos a√∫n)";
  }
}

loadData();
</script>
